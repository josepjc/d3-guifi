function init(){d3.json("data/guifi-d3-"+dataset+".min.json",function(e){function f(){d3.selectAll(".tooltip").style("opacity",function(e){return.9}).style("background","white").style("left",d3.event.pageX+14+"px").style("top",d3.event.pageY-12+"px")}var t=1420,n=1e3;var r=d3.scale.sqrt().range([5,40]).domain([0,100]);var i=0;zoom=d3.behavior.zoom();zoom.scaleExtent([.12,3]);var s=[];var o=[];var u={};vis.on("mousemove",f);vis.call(zoom.on("zoom",redraw));var a=d3.select("body").append("div").attr("id","tooltip").html("").attr("class","tooltip").style("display","none");e.nodes.forEach(function(e){if(e.type!=client&&e.type!=ap&&e.type!=Supernode){var t=s.push({label:e.name,status:e.STATUS,type:e.type,id:e.id})-1;u[e.id]=t}});e.links.forEach(function(e){var t={id:e.id,link_type:e.type,source:s[u[e.source]],target:s[u[e.target]],weight:1};if(t.source!=null&&t.target!=null){o.push(t)}else{}});var l=d3.layout.force().size([t,n]).nodes(s,function(e){return id}).links(o).gravity(1).linkDistance(50).charge(-4e3).linkStrength(10);l.start();var c=container.selectAll("line.link").data(o,function(e){return e.id}).enter().append("line").attr("class","link").style("stroke",function(e){switch(e.link_type){case"wds":return"orange";case"ap/client":return"#3383bb"}}).style("stroke-width",function(e){switch(e.link_type){case"wds":return"3";case"ap/client":return"1"}});var h=container.selectAll(".node").data(l.nodes()).enter().append("g").attr("class","node");var p=h.append("a").attr("xlink:href",function(e){return"http://www.guifi.net/node/"+e.id}).append("circle").attr("r",function(e){return r(e.weight)}).attr("class",function(e){switch(e.type){case"ap":return"circulo ap";case"client":return"circulo client";case"Supernode":return"circulo supernode"}});h.append("a").attr("xlink:href",function(e){return"http://www.guifi.net/node/"+e.id}).append("text").attr("class","labeln").attr("dx",30).attr("dy",".35em").text(function(e,t){if(e.weight>=6){return e.label}});p.on("mouseout",function(e){a.style("display","none")});p.on("mouseover",function(e){a.style("display","block").html("<span>"+e.label+"<br>"+e.id+" "+e.status+"</span>")});var d=function(){this.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})};var v=function(){this.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})};l.on("tick",function(){h.call(v);c.call(d)})})}function getChosenDataset(){var e=document.getElementById("dataset");return e.options[e.selectedIndex].value}function getChosenSelection3(){var e=document.getElementById("check3");return e.checked;console.log(e.checked)}function getChosenSelection2(){var e=document.getElementById("check2");return e.checked}function getChosenSelection1(){var e=document.getElementById("check1");return e.checked}function updateDataSet(){var e=d3.selectAll("line.link").remove();var t=d3.selectAll(".node").remove();var t=d3.selectAll("circle").remove();dataset=getChosenDataset();console.log(dataset);init()}function updateSelection3(){var e=d3.selectAll("line.link").remove();var t=d3.selectAll(".node").remove();var t=d3.selectAll("circle").remove();selectbox3=getChosenSelection3();console.log(selectbox3);if(selectbox3==true){ap=null}else{ap="ap"}console.log(ap,client,Supernode);init()}function updateSelection2(){var e=d3.selectAll("line.link").remove();var t=d3.selectAll(".node").remove();var t=d3.selectAll("circle").remove();selectbox2=getChosenSelection2();if(selectbox2==true){client=null}else{client="client"}console.log(selectbox2,ap,client,Supernode);init()}function updateSelection1(){var e=d3.selectAll("line.link").remove();var t=d3.selectAll(".node").remove();var t=d3.selectAll("circle").remove();selectbox1=getChosenSelection1();if(selectbox1==true){Supernode=null}else{Supernode="Supernode"}console.log(selectbox1,ap,client,Supernode);init()}var dataset="barcelones";var client=null;var ap=null;var Supernode=null;var vis=d3.select("body").append("svg").attr("width",1420).attr("height",1e3);var container=vis.append("g");redraw=function(){container.attr("transform","translate("+d3.event.translate+")"+" scale("+d3.event.scale+")")};init();document.getElementById("check3").addEventListener("change",updateSelection3,false);document.getElementById("check2").addEventListener("change",updateSelection2,false);document.getElementById("check1").addEventListener("change",updateSelection1,false);document.getElementById("dataset").addEventListener("change",updateDataSet,false)